<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Payroll</title>
</head>

<body id="fondo">
  <div class="container text-center">
    <h1>Planilla Periodo</h1>
    <div>
      <div *ngIf="header">
        <button class="btn btn-primary" id="modificar" (click)="backWelcome()"><i
            class="fa-solid fa-arrow-left-long"></i> Regresar</button>&nbsp;&nbsp;
        <button class="btn btn-danger" id="modificar" (click)="revoke()"> <i class="fa-solid fa-right-from-bracket"></i>
          Salir</button>
      </div>
    </div>
  </div>



  <div *ngIf="tabPeriodo">
    <div>
      <table id="table" id="table-consult">
        <thead>
          <tr>
            <th>Año</th>
            <th>Mes</th>
            <th>Fecha inicio</th>
            <th>Fecha Fin</th>
            <th>Fecha de creación</th>
            <th>Usuario de creación</th>
            <th>Usuario de modificación</th>
            <th>Fecha de modificación</th>
            <th>Opciones</th>
            <th>&nbsp;</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let periodoPlanilla of PayrollPeriodsData">
            <td>{{periodoPlanilla.idPK.year}}</td>
            <td>{{periodoPlanilla.idPK.month}}</td>
            <td>{{periodoPlanilla.startDate |date:'dd/MM/yyyy '}}</td>
            <td>{{periodoPlanilla.endDate |date:'dd/MM/yyyy '}}</td>
            <td>{{periodoPlanilla.creationDate |date:'dd/MM/yyyy hh:mm:ss'}}</td>
            <td>{{periodoPlanilla.userCreation}}</td>
            <td>{{periodoPlanilla.userModification}}</td>
            <td>{{periodoPlanilla.modificationDate |date:'dd/MM/yyyy hh:mm:ss'}}</td>
            <td>
              <div>
                <button *ngIf="btnUpdate" class="btn btn-secondary" id="modificar" (click)="Modify(periodoPlanilla)"> <i
                    class="fa-solid fa-pen-to-square"></i>
                  Modificar</button>
                <button *ngIf="!btnUpdate" class="btn btn-danger btn-sm" disabled>No Disponible</button>
              </div>
            </td>
            <td>
              <div>
                <button *ngIf="btnDelete" class="btn btn-danger" id="delete" (click)="Delete(periodoPlanilla)"> <i
                    class="fa-solid fa-delete-left"></i>
                  Eliminar</button>
              </div>
            </td>
          </tr>
        </tbody>

      </table>
      <div>

        <button *ngIf="btnAdd" class="btn btn-secondary" id="agregar" (click)="Add()"><i
            class="fa-regular fa-square-plus"></i> Agregar</button>
        &nbsp;
        <button *ngIf="exporte" class="btn btn-primary" id="exportar"><i class="fa-solid fa-download"></i>
          Exportar</button>
        &nbsp;
        <button *ngIf="print" class="btn btn-primary" id="imprimir"><i class="fa-solid fa-print"></i> Imprimir</button>

      </div>
    </div>
  </div>

  <div class="container text-left" *ngIf="modify">
    <form (ngSubmit)="modForm()" id="modForm">
      <h1>Modificación</h1>
      <div class="input-group mb-3">
        <span class="input-group-text"><i class="fa-regular fa-user"></i>&nbsp; Año</span>
        <input class="form-control" type="text" name="name" [(ngModel)]="paryrollPeriodDataModify.anio"
          placeholder="{{paryrollPeriodDataModify.anio}}" required>

        <span class="input-group-text"><i class="fa-regular fa-user"></i>&nbsp; Mes</span>
        <input class="form-control" type="text" name="name" [(ngModel)]="paryrollPeriodDataModify.mes"
          placeholder="{{paryrollPeriodDataModify.mes}}" required>
      </div>
      <div class="input-group mb-3">
        <span class="input-group-text"><i class="fa-regular fa-user"></i>&nbsp; Fecha inicio</span>
        <input type="date" id="startDate" [(ngModel)]="paryrollPeriodDataModify.startDate"
          placeholder="{{paryrollPeriodDataModify.startDate}}" name="startDate" class="form-control" required>

        <span class="input-group-text"><i class="fa-regular fa-user"></i>&nbsp; Fecha Fin</span>
        <input type="date" id="endDate" [(ngModel)]="paryrollPeriodDataModify.endDate"
          placeholder="{{paryrollPeriodDataModify.endDate}}" name="endDate" class="form-control" required>
      </div>
      <div>
        <button type="submit" class="btn btn-secondary">Confirmar</button>&nbsp;
        <button class="btn btn-primary" id="Regresar" (click)="back()">Regresar</button>
      </div>
    </form>
  </div>


  <div class="container text-left" *ngIf="add">
    <form (ngSubmit)="addForm()" id="addForm">
      <div class="input-group mb-3">
        <span class="input-group-text"><i class="fa-regular fa-user"></i>&nbsp;</span>
        <input class="form-control" type="number" name="name" [(ngModel)]="paryrollPeriodDataCreate.anio"
          placeholder="Año" required>

        <span class="input-group-text"><i class="fa-regular fa-user"></i>&nbsp;</span>
        <input class="form-control" type="number" name="name" [(ngModel)]="paryrollPeriodDataCreate.mes" placeholder="Mes"
          required>
      </div>
      <div class="input-group mb-3">
        <span class="input-group-text"><i class="fa-regular fa-user"></i>&nbsp;</span>
        <input type="date" id="startDate" [(ngModel)]="paryrollPeriodDataCreate.startDate" name="startDate"
          class="form-control" required>

        <span class="input-group-text"><i class="fa-regular fa-user"></i>&nbsp;</span>
        <input type="date" id="endDate" [(ngModel)]="paryrollPeriodDataCreate.endDate" name="endDate"
          class="form-control" required>
      </div>
      <br>
      <div>
        <button type="submit" class="btn btn-secondary">Confirmar</button>&nbsp;
        <button class="btn btn-primary" id="Regresar" (click)="back()">Regresar</button>
      </div>

    </form>
  </div>


  <div class="container-fluid">
    <h1 class="text-center">Generacion de planillas</h1>
  </div>
  &nbsp;

  <div class="container text-center" *ngIf="showSpinner">
    <h1>Espera por favor</h1>
    <div id="spinner" *ngIf="showSpinner" class="spinner-border m-5" role="status">
      <span class="sr-only"></span>
    </div>
  </div>
  <div class="text-center" *ngIf="!showSpinner">
    <button class="btn btn-secondary" (click)="generatePayroll()"> Generar Planilla</button>
    &nbsp;

    <button class="btn btn-secondary"> Calcular Planilla</button>
  </div>

  <div *ngIf="tab">
    <div>
      <table class="table table-hover" id="table-consult">
        <thead>
          <tr>
            <th>Id Planilla</th>
            <th>Año</th>
            <th>Mes</th>
            <th>Empleado</th>
            <th>Fecha de contratacion</th>
            <th>Puesto</th>
            <th>Estatus empleado</th>
            <th>Sueldo base</th>
            <th>Bonificacion decreto</th>
            <th>Otros ingresos</th>
            <th>Descuento IGGS</th>
            <th>Descuento ISR</th>
            <th>Descuento inasistencias</th>
            <th>Salario Neto</th>
            <th>Fecha de creación</th>
            <th>Usuario de creación</th>
            <th>Fecha de Modificaion</th>
            <th>Usuario de Modificacion</th>
            <th>Opciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let  data of personData">
            <td>{{data.idPayrollDetails}}</td>
            <td>{{data.year}}</td>
            <td>{{data.month}}</td>
            <td>{{getEmployeeName(data.idEmployee) }}</td>
            <td>{{data.dateOfHire}}</td>
            <td>{{getPositionName(data.idPosition) }}</td>
            <td>{{getStatusEmployeeName(data.idStatusEmployee) }}</td>
            <td>{{data.baseSalaryIncome | currency: 'Q '}}</td>
            <td>{{data.bonusIncomeDecree | currency: 'Q '}}</td>
            <td>{{data.incomeOther | currency: 'Q '}}</td>
            <td>{{data.igss | currency: 'Q '}}</td>
            <td>{{data.isr | currency: 'Q '}}</td>
            <td>{{data.noShowDiscount | currency: 'Q '}}</td>
            <td>{{data.netSalary | currency: 'Q '}}</td>
            <td>{{data.creationDate |date:'dd/MM/yyyy HH:mm:ss'}}</td>
            <td>{{data.userCreation}}</td>
            <td>{{data.modificationDate |date:'dd/MM/yyyy HH:mm:ss'}}</td>
            <td>{{data.userModification}}</td>
            <td>
              <div>
                <button *ngIf="btnUpdate" class="btn btn-secondary" id="modificar" (click)="Modify(data)"> <i
                    class="fa-solid fa-pen-to-square"></i>
                  &nbsp;Modificar</button>
                <button *ngIf="!btnUpdate" class="btn btn-danger btn-sm" disabled>No Disponible</button>


              </div>
            </td>

          </tr>
        </tbody>

      </table>
      <div>
        <button *ngIf="exporte" class="btn btn-primary" id="exportar"><i class="fa-solid fa-download"></i>
          Exportar</button>
        &nbsp;
        <button *ngIf="print" class="btn btn-primary" id="imprimir"><i class="fa-solid fa-print"></i>
          Imprimir</button>

      </div>
    </div>
  </div>


</body>

</html>